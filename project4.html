<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Social Media Data Charts</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <style>

    .container {
      float: left;
    }
        </style> -->
</head>
<body>
  <body>
    <h1 align="center">Mortality Statistics</h1>
    <div class ="btn-group" role="group">
      <h3>Based on this year?</h3>
      <button type="button" class="btn btn-default btn1" id="year">2003</button>
      <button type="button" class="btn btn-default btn2" id="year">2008</button>
      <button type="button" class="btn btn-default btn3" id="year">2013</button>
    </div>
    <div style="text-align:center;"><svg  class = "container" id = "gender" height = "500" width = "700" style="border: 1px solid grey" style="float: left"</svg></div>
    <h3 align= "center">Gender Distribution</h3>
    <div style="text-align:center;"><svg class = "container" id = "marital" height = "500" width = "700" style="border: 1px solid grey"</svg></div>
    <h3 align= "center">Marital Status Distribution</h3>
    <div style="text-align:center;"> <svg class = "container" id = "age" height = "500" width = "700" style="border: 1px solid grey" </svg></div>
    <h3 align= "center">Age at Death Distribution</h3>


    <script type="text/javascript">
      var Gsvg = d3.select("#gender");
      var Gheight = Gsvg.attr("height");
      var Gwidth = Gsvg.attr("width");
      var Msvg = d3.select("#marital");
      var Mheight = Msvg.attr("height");
      var Mwidth = Msvg.attr("width");
      var Asvg = d3.select("#age");
      var Aheight = Asvg.attr("height");
      var Awidth = Asvg.attr("width");

      var GLOBAL = {dataset: [], single: [], married: [], widowed: [], divorced: [], unknown: [], male :[], female: [], age0_9: [], age10_19: [], age20_29: [], age30_39: [], age40_49: [], age50_59: [], age60_69: [], age70_79: [], age80_89: [], age90_99: [], over100: []};
      var fields = {year: ["2003","2008","2013"], Sex: ["M", "F"],
                Marriage: ["S", "M", "W", "D", "U"]}
      window.addEventListener("load", run);

      function run () {
          d3.json("../YearSexMarriageAge.json", function(data1){
              GLOBAL.dataset = data1;
              //console.log("Json done")
              //console.log(data1["2003"]) //Log output to console
              d3.selectAll("button.btn1").on("click", function(){
                console.log("CLICKED year");
                Marital();
                Gender();
                Age();
                draw();
              });
              d3.selectAll("button.btn2").on("click", function(){
                console.log("CLICKED year");
                Marital();
                Gender();
                Age();
                console.log(GLOBAL);
                draw();
              });
              d3.selectAll("button.btn3").on("click", function(){
                console.log("CLICKED year");
                Marital();
                Gender();
                Age();
                draw();
              });
          });

    }

    function Gender(){
        console.log("GENDER")
        for (var i in fields.year){
          for (var j in fields.Marriage){
            GLOBAL.male = GLOBAL.male.concat(
              GLOBAL.dataset[fields.year[i]]["M"][fields.Marriage[j]]);
            GLOBAL.female = GLOBAL.female.concat(
              GLOBAL.dataset[fields.year[i]]["F"][fields.Marriage[j]]);
          }
        }
    }

    //year, sex, marriage, age
    function Marital(){
        console.log("Marital")
        for(var i in fields.year){
          for(var j in fields.Sex){

            GLOBAL.single = GLOBAL.single.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]]["S"])

            GLOBAL.married = GLOBAL.married.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]]["M"])

            GLOBAL.widowed = GLOBAL.widowed.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]]["W"])

            GLOBAL.divorced = GLOBAL.divorced.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]]["D"])

            GLOBAL.unknown = GLOBAL.unknown.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]]["U"])
          }
        }
    }

    //Sorry for this messy array of functions...
    function filterAge0(age){
      return age >= 0 && age < 10;
    }
    function filterAge10(age){
      return age >= 10 && age < 20;
    }
    function filterAge20(age){
      return age >= 20 && age < 30;
    }
    function filterAge30(age){
      return age >= 30 && age < 40;
    }
    function filterAge40(age){
      return age >= 40 && age < 50;
    }
    function filterAge50(age){
      return age >= 50 && age < 60;
    }
    function filterAge60(age){
      return age >= 60 && age < 70;
    }
    function filterAge70(age){
      return age >= 70 && age < 80;
    }
    function filterAge80(age){
      return age >= 80 && age < 90;
    }
    function filterAge90(age){
      return age >= 90 && age < 100;
    }
    function filterAge100(age){
      return age >= 100;
    }

    //I couldn't think of a better way...
    function Age(){
      for(var i in fields.year){
        for(var j in fields.Sex){
          for(var k in fields.Marriage){
            GLOBAL.age0_9 = GLOBAL.age0_9.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge0));
            GLOBAL.age10_19 = GLOBAL.age10_19.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge10));
            GLOBAL.age20_29 = GLOBAL.age20_29.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge20));
            GLOBAL.age30_39 = GLOBAL.age30_39.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge30));
            GLOBAL.age40_49 = GLOBAL.age40_49.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge40));
            GLOBAL.age50_59 = GLOBAL.age50_59.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge50));
            GLOBAL.age60_69 = GLOBAL.age60_69.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge60));
            GLOBAL.age70_79 = GLOBAL.age70_79.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge70));
            GLOBAL.age80_89 = GLOBAL.age80_89.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge80));
            GLOBAL.age90_99 = GLOBAL.age90_99.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge90));
            GLOBAL.over100 = GLOBAL.over100.concat(
              GLOBAL.dataset[fields.year[i]][fields.Sex[j]][fields.Marriage[k]].filter(
                filterAge100));
          }
        }
      }

    }

    function draw(){
        console.log("draw")
        var data = [ GLOBAL.single.length/30000, GLOBAL.married.length/30000,
        GLOBAL.widowed.length/30000,GLOBAL.divorced.length/30000,GLOBAL.unknown.length/30000,];
        console.log(data);
        var circles = Msvg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle");

        circles.attr("cx", function(d, i) {
        return (i * 120) + 40;})
        .attr("cy", function(d, i) {
          if(i%2===0){
            return (Mheight/2)+100;
          }
          else{
            return (Mheight/2)-100;
          }})
        .attr("r", function(d) {
            return d;})
        .attr("fill", "yellow")
        .attr("stroke", "orange")
        .attr("stroke-width", function(d) {
            return d/2;});

        var data1 = [ GLOBAL.male.length, GLOBAL.female.length ];
        console.log(data1)
        var bars = Gsvg.selectAll("rect")
        .data(data1)
        .enter()
        .append("rect")
        .attr("x", function(d,i){return (Gheight/3)*(i+1)} )
        .attr("y", 0)
        .attr("width", 20)
        .attr("height", 100);
        }

        // data2 = [1,2,3,4,5];
        // data3 = [1,2,3,4,5];
        // var x = d3.time.scale().range([0, Awidth]);
        // var y = d3.scale.linear().range([Aheight, 0]);
        // var line = d3.svg.line()
        // .x(function(d) { return x(d.data2); })
        // .y(function(d) { return y(d.data3); });
        // var lines = Asvg.append("line")
        //                  .attr(x)
        //                  .attr(y);
        //
        // var array = [1,2,3,4,5,6]
        // var line = d3.svg.line()
        //     .x(function(d) { return Math.random() * 1000 })
        //     .y(function(d) { return Math.random() * 1000});
        //
        // <!-- Adding to the svg -->
        // .append('path')
        // .attr('d', line(array))
        //http://stackoverflow.com/questions/13570048/drawing-simple-lines-with-d3js

    </script>
  </body>
</html>
